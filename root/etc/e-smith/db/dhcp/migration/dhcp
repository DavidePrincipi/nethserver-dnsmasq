{
    use esmith::NetworksDB;

    return '' unless $dnsmasq;
    my $status = $DB->get_prop_and_delete('dnsmasq','DhcpStatus') || return '';
    my $start = $DB->get_prop_and_delete('dnsmasq','DhcpRangeStart') || return '';
    my $end = $DB->get_prop_and_delete('dnsmasq','DhcpRangeEnd') || return '';
    my $gw = $DB->get_prop_and_delete('dnsmasq','DhcpGatewayIp') || '';
    my $lease = $DB->get_prop_and_delete('dnsmasq','DhcpLeaseTime') || '86400';

    if ($start ne '0.0.0.0' && $end ne  '0.0.0.0') {
        my $dhcp = esmith::ConfigDB->open('dhcp');
        my $ndb = esmith::NetworksDB->open_ro();
        my $green = $ndb->green();
        $dhcp->new_record($green->key, 
            { type => 'range', status => $status, DhcpRangeStart => $start, DhcpRangeEnd => $end, DhcpGatewayIp => $gw, DhcpLeaseTime => $lease }
        );
    }
}
